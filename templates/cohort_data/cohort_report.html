<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Cohort {{ cohort.acronym  }}</title>
  <style>
body {
  font-family: system-ui, sans-serif;
  background-color: #f9fafb;
  color: #1f2937;
  margin: 2rem;
}

/* --- Section containers --- */
section {
  background-color: #ffffff;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  margin: 1.5rem auto;
  padding: 1.5rem;
  overflow-x: auto;
  max-width: 1200px;
}

section h2 {
  margin-bottom: 0.75rem;
  font-size: 1.2rem;
  color: #111827;
}

/* --- Table layout --- */
table {
  border-collapse: collapse;
  border: none;
  margin: 0 auto;
  table-layout: fixed; /* prevents stretching */
  width: auto; /* only as wide as content */
  min-width: 600px;
}

/* No visible table borders */
th, td {
  border: none;
}

/* --- Header styling --- */
thead,
th,
.hpo-col-th,
.rotate-header {
  overflow: visible !important;
}

.rotate-header {
  height: 110px;
  vertical-align: bottom;
  position: relative;
  background-color: transparent; /* no gray background */
  border-bottom: 1px solid #e5e7eb; /* subtle separator line */
  overflow: visible; /* ensure rotated text is not cut off */
}

.hpo-col-th {
  height: 110px;
  overflow: visible;
}

.hpo-col .rotated-text {
  transform: rotate(-30deg);
  transform-origin: left bottom;
  white-space: nowrap;
  position: absolute;
  bottom: 8px;
  left: 45%;
  font-size: 0.75rem;
  line-height: 1;
  text-overflow: ellipsis;
  max-width: 120px;
  overflow: visible;
}

/* --- Row + cell look --- */
td {
  padding: 6px 8px;
  text-align: center;
  vertical-align: middle;
  overflow: visible;
}

/* --- Individual cell types --- */
.observed-cell {
  background-color: #d1fadf;
  font-weight: bold;
  color: #1a7f37;
}

.excluded-cell {
  background-color: #fde8e8;
  font-weight: bold;
  color: #b91c1c;
}

.onset-cell {
  background-color: #dbeafe;
  color: #1e40af;
  font-weight: 500;
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.1s ease-in;
  border-radius: 6px;
  max-width: 4rem;
}

.onset-cell:hover {
  background-color: #bfdbfe;
  box-shadow: 0 0 3px rgba(30, 64, 175, 0.4);
}

.na-cell {
  background-color: #f5f5f5;
  color: #999;
  font-style: italic;
}

/* --- Wide special cells --- */
.pmid-cell {
  background-color: #f8fafc;
  font-family: monospace;
  color: #0f172a;
  font-size: 0.85rem;
  text-align: left;
  padding: 4px 10px;
  min-width: 8rem;
  max-width: 10rem;
}

.individual-cell {
  background-color: #f1f5f9;
  color: #1e293b;
  font-weight: 500;
  text-align: left;
  padding: 4px 10px;
  min-width: 10rem;
  max-width: 14rem;
}

/* Hover highlight */
.pmid-cell:hover,
.individual-cell:hover {
  background-color: #e2e8f0;
}

/* --- Headings --- */
h1 {
  font-size: 1.75rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
}
</style>

</head>
<body>
  <h1>Cohort Overview</h1>
  </p>
  <div class="text-sm text-gray-700 space-y-2">
    <h2>{{ cohort.acronym }}</h2>  
    <p>
        <ul>
          <li>HPO version: {{ cohort.hpoVersion }}</li>
          <li>Phetools schema version: {{ cohort.phetoolsSchemaVersion }}</li>
          <li>Cohort type: {{ cohort.cohortType }}</li>
          <li>Phenopackets: {{ cohort.nPhenopackets }}</li>
        <li>Distinct HPO terms : {{ cohort.nDistinctHpoTerms }}</li>
        </ul>
      </p>
      <ul>
      {% for disease in cohort.diseaseList %}
        <li>
          <a href="https://omim.org/entry/{{ disease.diseaseId }}" target="_blank"
             class="text-blue-600 underline">
            {{ disease.diseaseLabel }} ({{ disease.diseaseId }})
          </a>
          {% if disease.geneTranscriptList | length > 0 %}
            (
            {% for gene in disease.geneTranscriptList %}
              <i>{{ gene.geneSymbol }}</i>{% if not loop.last %}, {% endif %}
            {% endfor %}
            )
          {% endif %}
        </li>
      {% endfor %}
      </ul>

    </div>
    {% for top_level in cohort.topLevelList %}
  <section class="my-8 bg-gray-50 border border-gray-200 rounded-xl shadow-md overflow-hidden">
  <div class="p-4 pb-2">
    <h2 class="text-2xl font-semibold text-gray-800 mb-2">
      {{ top_level.topLevelName }}
    </h2>
  </div>  
    <div class="overflow-x-auto">
      <table class="min-w-full border border-gray-300 text-sm">
        <thead>
          <tr>
            <th class="border px-3 py-2 text-left font-semibold text-gray-700"></th>
            <th class="border px-3 py-2 text-left font-semibold text-gray-700"></th>

            {% for header in top_level.hpoHeader %}
              <th class="rotate-header hpo-col hpo-col-th border relative group">
                <div class="rotated-text hover-underline">
                   <a href="https://hpo.jax.org/browse/term/{{ header.hpoId }}"
                    target="_blank"
                    rel="noopener"
                    class="text-blue-600 underline">
                    üîó {{ header.hpoLabel }}
                  </a>
                </div>
              </th>
            {% endfor %}
          </tr>
        </thead>



        <tbody>
          {% for row in top_level.rows %}
            <tr class="hover:bg-gray-50">
              {% for cell in row %}
                <td class="
                  hpo-col
                  
                  {% if cell.cellType == 'Observed' %}observed-cell{% endif %}
                  {% if cell.cellType == 'Excluded' %}excluded-cell{% endif %}
                  {% if cell.cellType == 'OnsetAge' %}onset-cell{% endif %}
                   {% if cell.cellType == 'Pmid' %}pmid-cell{% endif %}
                    {% if cell.cellType == 'IndividualData' %}individual-cell{% endif %}
                  {% if cell.cellType == 'Na' %}na-cell{% endif %}
                  border px-3 py-2
                ">
                  {% if cell.cellType == "Observed" %}
                    ‚úÖ
                  {% elif cell.cellType == "Excluded" %}
                    ‚ùå
                  {% elif cell.cellType == "Na" %}
                    n/a
                  {% elif cell.cellType == "OnsetAge" %}
                    <div class="onset-content" title="{{ cell.cellContents }}">
                      <span class="onset-icon">üïí</span>
                      <span class="onset-text">{{ cell.cellContents }}</span>
                    </div>
                    {% elif cell.cellType == 'Pmid' %} <a href="https://pubmed.ncbi.nlm.nih.gov/{{ cell.cellContents  }}/"
                    target="_blank"
                    rel="noopener"
                    class="text-blue-600 underline">
                    üîó PMID:{{ cell.cellContents  }}
                  </a>
                  {% elif cell.cellType == 'IndividualData' %}
                    {{ cell.cellContents }}
                  {% else %}
                    <span>Unknown</span>
                  {% endif %}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
{% endfor %}

</body>
</html>
