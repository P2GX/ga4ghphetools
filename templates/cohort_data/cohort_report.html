<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Cohort {{ cohort.acronym  }}</title>
  <style>
body {
  font-family: system-ui, sans-serif;
  background-color: #f9fafb;
  color: #1f2937;
  margin: 2rem;
}

/* --- Section containers --- */
section {
  background-color: #ffffff;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  margin: 1.5rem auto;
  padding: 1.5rem;
  overflow-x: auto;
  max-width: 1200px;
}

section h2 {
  margin-bottom: 0.75rem;
  font-size: 1.2rem;
  color: #111827;
}

/* --- Table layout --- */
table {
  border-collapse: collapse;
  border: none;
  margin: 0 auto;
  table-layout: fixed; /* prevents stretching */
  width: auto; /* only as wide as content */
  min-width: 600px;
}

/* No visible table borders */
th, td {
  border: none;
}

/* --- Header styling --- */
thead,
th,
.hpo-col-th,
.rotate-header {
  overflow: visible !important;
}

.rotate-header {
  height: 110px;
  vertical-align: bottom;
  position: relative;
  background-color: transparent; /* no gray background */
  border-bottom: 1px solid #e5e7eb; /* subtle separator line */
  overflow: visible; /* ensure rotated text is not cut off */
}

.hpo-col-th {
  height: 110px;
  overflow: visible;
}

.hpo-col .rotated-text {
  transform: rotate(-30deg);
  transform-origin: left bottom;
  white-space: nowrap;
  position: absolute;
  bottom: 8px;
  left: 45%;
  font-size: 0.75rem;
  line-height: 1;
  text-overflow: ellipsis;
  max-width: 120px;
  overflow: visible;
}

/* --- Row + cell look --- */
td {
  padding: 6px 8px;
  text-align: center;
  vertical-align: middle;
  overflow: visible;
}

/* --- Individual cell types --- */
.observed-cell {
  background-color: #d1fadf;
  font-weight: bold;
  color: #1a7f37;
}

.excluded-cell {
  background-color: #fde8e8;
  font-weight: bold;
  color: #b91c1c;
}

.onset-cell {
  background-color: #dbeafe;
  color: #1e40af;
  font-weight: 500;
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.1s ease-in;
  border-radius: 6px;
  max-width: 4rem;
}

.onset-cell:hover {
  background-color: #bfdbfe;
  box-shadow: 0 0 3px rgba(30, 64, 175, 0.4);
}

.na-cell {
  background-color: #f5f5f5;
  color: #999;
  font-style: italic;
}
 
.pmid-cell {
  background-color: #f8fafc;
  font-family: monospace;
  color: #0f172a;
  font-size: 0.85rem;
  text-align: left;
  min-width: 8rem;
  max-width: 10rem;
  padding: 6px 10px;         /* a bit more breathing room */
  border-right: 1px solid #e2e8f0;
  vertical-align: middle;
  position: relative;        /* required for tooltip positioning */
  overflow: hidden;          /* ensure ellipsis works */
  white-space: nowrap;
  text-overflow: ellipsis;
}

/* Anchor styling (inside cell) */
.pmid-cell a {
  display: inline-block;
  max-width: 40ch;           /* limit text to ~40 characters */
  padding-right: 6px;        /* ensure ellipsis has space */
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  color: #0f172a;
  text-decoration: underline dotted;
  text-underline-offset: 2px;
  vertical-align: middle;
}

/* Hover tooltip for full text */
.pmid-cell a:hover::after {
  content: attr(title);
  position: absolute;
  left: 0;
  bottom: 100%;              /* show tooltip above cell */
  transform: translateY(-4px);
  background-color: #ffffff;
  color: #111827;
  font-family: monospace;
  font-size: 0.8rem;
  border: 1px solid #cbd5e1;
  border-radius: 4px;
  padding: 4px 6px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
  white-space: normal;
  z-index: 10;
  width: max-content;
  max-width: 40rem;
}

/* Optional hover effect for visibility */
.pmid-cell:hover {
  background-color: #eef2f7;
}

.individual-cell {
  background-color: #f1f5f9;
  color: #1e293b;
  font-weight: 500;
  text-align: left;
  padding: 4px 10px;
  min-width: 10rem;
  max-width: 14rem;
}

/* Hover highlight */
.pmid-cell:hover,
.individual-cell:hover {
  background-color: #e2e8f0;
}

/* --- Headings --- */
h1 {
  font-size: 1.75rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
}

/* ======= Navigation Menu ======= */
.section-nav {
  margin: 1.5rem 0 2rem 0;
  padding: 0.75rem 1rem;
  background-color: #f8fafc; /* light gray-blue */
  border: 1px solid #e2e8f0;
  border-radius: 0.75rem;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 0.5rem 0.75rem;
  font-size: 0.9rem;
}

.section-nav span {
  font-weight: 600;
  color: #334155;
  margin-right: 0.5rem;
  white-space: nowrap;
}

.section-nav a {
  display: inline-block;
  padding: 0.35rem 0.9rem;
  background-color: #e2e8f0;
  color: #0f172a;
  border-radius: 9999px; /* pill shape */
  text-decoration: none;
  transition: all 0.2s ease;
  font-weight: 500;
  line-height: 1.2;
}

.section-nav a:hover {
  background-color: #cbd5e1;
  color: #1e293b;
  transform: translateY(-1px);
}

.section-nav a:active {
  background-color: #94a3b8;
  transform: scale(0.98);
}


/* ======= Back to top link ======= */
.back-to-top {
  font-size: 0.85rem;
  color: #64748b; /* slate gray */
  text-decoration: none;
  background-color: #f1f5f9;
  padding: 4px 8px;
  border-radius: 4px;
  transition: all 0.15s ease;
}

.back-to-top:hover {
  background-color: #e2e8f0;
  color: #334155;
  text-decoration: underline;
}

td.allele-cell {
  min-width: 20rem;  /* wider minimum */
  max-width: 40rem;  /* allows expansion if table is large */
  white-space: normal; /* allow wrapping if long */
  vertical-align: top;
}
.allele-item {
  display: block;              /* one per line instead of inline */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 35ch;             /* allow more text */
  padding: 3px 6px;
  border-radius: 6px;
  background-color: #f1f5f9;
  font-family: monospace;
  margin: 2px 0;
  cursor: help;
}

.allele-item:hover {
  background-color: #e2e8f0;
}
.allele-header {
  min-width: 20rem;  /* same as .allele-cell */
  max-width: 40rem;
  white-space: nowrap;
}


</style>

</head>
<body>
  
  <h1>Cohort Overview</h1>
  <a id="top"></a>
  </p>
  <div class="text-sm text-gray-700 space-y-2">
    <h2>{{ cohort.acronym }}</h2>  
    <p>
        <ul>
          <li>HPO version: {{ cohort.hpoVersion }}</li>
          <li>Phetools schema version: {{ cohort.phetoolsSchemaVersion }}</li>
          <li>Cohort type: {{ cohort.cohortType }}</li>
          <li>Phenopackets: {{ cohort.nPhenopackets }}</li>
        <li>Distinct HPO terms : {{ cohort.nDistinctHpoTerms }}</li>
        </ul>
      </p>
      <ul>
      {% for disease in cohort.diseaseList %}
        <li>
          <a href="https://omim.org/entry/{{ disease.diseaseId }}" target="_blank"
             class="text-blue-600 underline">
            {{ disease.diseaseLabel }} ({{ disease.diseaseId }})
          </a>
          {% if disease.geneTranscriptList | length > 0 %}
            (
            {% for gene in disease.geneTranscriptList %}
              <i>{{ gene.geneSymbol }}</i>{% if not loop.last %}, {% endif %}
            {% endfor %}
            )
          {% endif %}
        </li>
      {% endfor %}
      </ul>
<div class="section-nav">
  <span>Jump to:</span>
  <a href="#alleles">Individuals and alleles</a>
  {% for top_level in cohort.topLevelList %}
      <a href="#{{ top_level.anchor }}">{{ top_level.topLevelName }}</a>
  {% endfor %}
</div>

  {% if cohort.individuals %}
<section id="alleles" class="my-8 bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden">
  <div class="p-4 pb-2">
    <h2 class="text-2xl font-semibold text-gray-800 mb-2">
      Individuals and Allele Summary
    </h2>
     <a href="#top" class="back-to-top">⬆ Back to top</a>
  </div>
  <div class="overflow-x-auto">
    <table class="min-w-full text-sm border border-gray-300">
      <thead>
        <tr class="bg-gray-100">
          <th class="px-3 py-2 text-left font-semibold text-gray-700">Individual ID</th>
          <th class="px-3 py-2 text-left font-semibold text-gray-700">PMID</th>
          <th class="px-3 py-2 text-left font-semibold text-gray-700">Sex</th>
          <th class="px-3 py-2 text-left font-semibold text-gray-700">Onset Age</th>
          <th class="px-3 py-2 text-left font-semibold text-gray-700">Current Age</th>
          <th class="px-3 py-2 text-left font-semibold text-gray-700">Deceased</th>
          <th class="allele-header px-3 py-2 text-left font-semibold text-gray-700">Alleles</th>
        </tr>
      </thead>
      <tbody>
        {% for row in cohort.individuals %}
        <tr class="hover:bg-gray-50">
          <td class="individual-cell">{{ row.individualId }}</td>
          <td class="pmid-cell">
            <a href="https://pubmed.ncbi.nlm.nih.gov/{{ row.pmid }}/" target="_blank" rel="noopener">
              {{ row.title }}
            </a>
          </td>
          <td class="px-3 py-2">{{ row.sex }}</td>
          <td class="px-3 py-2">{{ row.onsetAge }}</td>
          <td class="px-3 py-2">{{ row.lastEncounter }}</td>
          <td class="px-3 py-2">{{ row.deceased }}</td>
          <td class="allele-cell px-3 py-2">
            {% for allele in row.alleles %}
              <div class="allele-item" title="{{ allele }}">{{ allele }}</div>
            {% endfor %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="text-right text-sm text-gray-500 p-3">
  </div>
</section>
{% endif %}



    </div>
    {% for top_level in cohort.topLevelList %}
   <section id="{{ top_level.anchor }}" class="my-8 bg-gray-50 border border-gray-200 rounded-xl shadow-md overflow-hidden">
    <div class="p-4 pb-2 flex justify-between items-center">
      <h2 class="text-2xl font-semibold text-gray-800 mb-2">
        {{ top_level.topLevelName }}
      </h2>
      <a href="#top" class="back-to-top">⬆ Back to top</a>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full border border-gray-300 text-sm">
        <thead>
          <tr>
            <th class="border px-3 py-2 text-left font-semibold text-gray-700"></th>
            <th class="border px-3 py-2 text-left font-semibold text-gray-700"></th>

            {% for header in top_level.hpoHeader %}
              <th class="rotate-header hpo-col hpo-col-th border relative group">
                <div class="rotated-text hover-underline">
                   <a href="https://hpo.jax.org/browse/term/{{ header.hpoId }}"
                    target="_blank"
                    rel="noopener"
                    class="text-blue-600 underline">
                    🔗 {{ header.hpoLabel }}
                  </a>
                </div>
              </th>
            {% endfor %}
          </tr>
        </thead>



        <tbody>
          {% for row in top_level.rows %}
            <tr class="hover:bg-gray-50">
              <td class="individual-cell">{{ row.individualId}}</td>
                <td class="pmid-cell"><a href="https://pubmed.ncbi.nlm.nih.gov/{{ row.pmid  }}/"
                    target="_blank"
                    rel="noopener"
                    class="text-blue-600 underline">
                    🔗 PMID:{{ row.title  }}
                  </a></td>
              {% for cell in row.values %}
                <td class="
                  hpo-col
                  {% if cell.cellType == 'Observed' %}observed-cell{% endif %}
                  {% if cell.cellType == 'Excluded' %}excluded-cell{% endif %}
                  {% if cell.cellType == 'OnsetAge' %}onset-cell{% endif %}
                   {% if cell.cellType == 'Pmid' %}{% endif %}
                    {% if cell.cellType == 'IndividualData' %}{% endif %}
                  {% if cell.cellType == 'Na' %}na-cell{% endif %}
                  border px-3 py-2
                ">
                  {% if cell.cellType == "Observed" %}
                    ✅
                  {% elif cell.cellType == "Excluded" %}
                    ❌
                  {% elif cell.cellType == "Na" %}
                    n/a
                  {% elif cell.cellType == "OnsetAge" %}
                    <div class="onset-content" title="{{ cell.cellContents }}">
                      <span class="onset-icon">🕒</span>
                    </div>
                  {% else %}
                    <span>Unknown</span>
                  {% endif %}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
{% endfor %}

</body>
</html>
