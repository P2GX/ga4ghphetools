<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Cohort {{ cohort.cohortAcronym | default(value="(no acronym)") }}</title>
  <style>

  .rotate-header {
  height: 80px;
  vertical-align: bottom;
  position: relative;
}

.hpo-col {
  position: relative;
  width: auto;
  max-width: 3.5rem;
  white-space: nowrap;
  text-align: center;
  vertical-align: bottom;
  overflow: visible;
}

.hpo-col-th {
  height: 200px;
}

.hpo-col .rotated-text {
  transform: rotate(-30deg);
  transform-origin: left bottom;
  white-space: nowrap;
  position: absolute;
  bottom: 5px;
  left: 45%;
  font-size: 10px;
  line-height: 1;
  text-overflow: ellipsis;
  max-width: 100px;
}

.hover-underline {
  text-decoration: underline;
  text-decoration-style: dotted;
  text-underline-offset: 2px;
}

/* Popup styling */
.hpo-popup {
  position: absolute;
  top: 30px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #f9f9f9;
  border: 1px solid #ccc;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 11px;
  z-index: 100;
  white-space: nowrap;
  box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
  display: none;
}

th.group:hover .hpo-popup {
  display: block;
}

    .hpo-col {
  text-align: center;
  vertical-align: middle;
  transition: background-color 0.1s ease-in;
}

.observed-cell {
  background-color: #d1fadf;
  font-weight: bold;
  color: #1a7f37; /* Dark green */
}

.excluded-cell {
  background-color: #fde8e8;
  font-weight: bold;
  color: #b91c1c; /* Dark red */
}

.onset-content {
  display: flex;
  align-items: center;
  justify-content: center;
  max-width: 4rem;
  border-radius: 6px;
  background-color: inherit;
  color: #1e40af;
  font-weight: 500;
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.1s ease-in;
  padding: 2px 4px;
}

.onset-cell {
  align-items: center;
  justify-content: center;
  max-width: 4rem;
  border-radius: 6px;
  background-color: #dbeafe;
  color: #1e40af;
  font-weight: 500;
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.1s ease-in;
}

.onset-cell:hover {
  background-color: #bfdbfe;
  box-shadow: 0 0 3px rgba(30, 64, 175, 0.4);
}

.onset-cell .onset-text {
  display: none;
}

.onset-cell:hover .onset-text {
  display: inline;
}

.onset-cell:hover .onset-icon {
  display: none;
}

.na-cell {
  background-color: #f5f5f5;
  color: #999;
  font-style: italic;
}
  </style>
</head>
<body>
  <h1>Cohort Overview</h1>
<pre>{{ __tera_context | json_encode(pretty=true) }}</pre>

  </p>
  <div class="text-sm text-gray-700 space-y-2">
    <h2>{{ cohort.cohortAcronym | default(value="(n/a)")}}</h2>  
    <p>
        <ul>
          <li>HPO version: {{ cohort.hpoVersion }}</li>
          <li>Phetools schema version: {{ cohort.phetoolsSchemaVersion }}</li>
          <li>Cohort type: {{ cohort.cohortType }}</li>
          <li>Phenopackets: {{ cohort.nPhenopackets }}</li>
        <li>Distinct HPO terms : {{ cohort.nDistinctHpoTerms }}</li>
        </ul>
      </p>
      <ul>
      {% for disease in cohort.diseaseList %}
        <li>
          <a href="https://omim.org/entry/{{ disease.diseaseId }}" target="_blank"
             class="text-blue-600 underline">
            {{ disease.diseaseLabel }} ({{ disease.diseaseId }})
          </a>
          {% if disease.geneTranscriptList | length > 0 %}
            (
            {% for gene in disease.geneTranscriptList %}
              <i>{{ gene.geneSymbol }}</i>{% if not loop.last %}, {% endif %}
            {% endfor %}
            )
          {% endif %}
        </li>
      {% endfor %}
      </ul>

    </div>
    {% for top_level in cohort.topLevelList %}
  <section class="my-8 p-4 bg-white rounded-lg shadow">
    <h2 class="text-2xl font-semibold text-gray-800 mb-4">
      {{ top_level.topLevelName }}
    </h2>

    <div class="overflow-x-auto">
      <table class="min-w-full border border-gray-300 text-sm">
        <thead>
          <tr>
            <th class="border px-3 py-2 text-left font-semibold text-gray-700">PMID</th>
            <th class="border px-3 py-2 text-left font-semibold text-gray-700">Individual</th>

            {% for header in top_level.hpoHeader %}
              <th class="rotate-header hpo-col hpo-col-th border relative group">
                <div class="rotated-text hover-underline">
                  {{ header.hpoLabel }}
                </div>

                <!-- Popup shown on hover -->
                <div class="hpo-popup hidden group-hover:block">
                  <a href="https://hpo.jax.org/browse/term/{{ header.hpoId }}"
                    target="_blank"
                    rel="noopener"
                    class="text-blue-600 underline">
                    üîó {{ header.hpoId }}
                  </a>
                </div>
              </th>
            {% endfor %}
          </tr>
        </thead>



        <tbody>
          {% for row in top_level.rows %}
            <tr class="hover:bg-gray-50">
              {% for cell in row %}
                <td class="
                  hpo-col
                  {% if cell.cellType == 'Observed' %}observed-cell{% endif %}
                  {% if cell.cellType == 'Excluded' %}excluded-cell{% endif %}
                  {% if cell.cellType == 'OnsetAge' %}onset-cell{% endif %}
                  {% if cell.cellType == 'Na' %}na-cell{% endif %}
                  border px-3 py-2
                ">
                  {% if cell.cellType == "Observed" %}
                    ‚úÖ
                  {% elif cell.cellType == "Excluded" %}
                    ‚ùå
                  {% elif cell.cellType == "Na" %}
                    n/a
                  {% elif cell.cellType == "OnsetAge" %}
                    <div class="onset-content" title="{{ cell.cellContents }}">
                      <span class="onset-icon">üïí</span>
                      <span class="onset-text">{{ cell.cellContents }}</span>
                    </div>
                  {% else %}
                    <span>Unknown</span>
                  {% endif %}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
{% endfor %}

</body>
</html>
